# Code Conventions & Rules

## Critical Rules

### NEVER DO THIS
1. **Never modify dist/ manually** - Always auto-generated by build
2. **Never edit src/**/index.ts manually** - Auto-generated by Python script
3. **Never add 'use client' directive manually** - Rollup plugin injects it
4. **Never skip `npm run generate-index`** - After adding/removing files
5. **Never commit with lint warnings** - CI will fail
6. **Never skip build before PR** - dist/ must be current
7. **Never use `any` type** - Strict TypeScript mode enabled
8. **Never ignore ESLint errors** - max-warnings=0 enforced

### ALWAYS DO THIS
1. **Always run `npm install` first** - Before any other command
2. **Always run `npm run generate-index`** - After file changes
3. **Always run `npm run lint`** - Before committing
4. **Always run `npm run build`** - Before pushing
5. **Always use Plop** - For new components (`npm run plop`)
6. **Always follow import order** - ESLint enforces: React → external → @/ → relative → styles
7. **Always use CSS Modules** - Component.module.scss pattern
8. **Always use `useOptionalSekai`** - For themed components
9. **Always extend base HTML props** - When creating wrapper components
10. **Always forward `...rest` props** - To underlying elements

---

## Import Order (ESLint enforced)
```typescript
// 1. React imports
import type React from 'react'
import { useState } from 'react'

// 2. External libraries
import clsx from 'clsx'

// 3. @/ path alias imports
import type { ColorsSekaiKey } from '@/styles/sekai-colors'
import { useOptionalSekai } from '@/internal/useOptionalSekai'
import globalStyles from '@/styles/global.module.scss'

// 4. Relative imports
import { helper } from './helper'

// 5. Styles (ALWAYS LAST)
import styles from './Component.module.scss'
```

---

## ESLint Rules Enforced
- Cyclomatic complexity ≤ 8
- Max 150 lines per function
- No console.log, debugger, alert
- Prefer const over let
- Exhaustive dependency arrays in hooks
- No unused imports/variables
- Type-only imports for types (`import type`)
- jsx-a11y accessibility checks

---

## TypeScript Conventions

### Type Utilities (from `@/utils/type`)
```typescript
ValueOf<T>              // Union of object values
ArrayElement<T>         // Array element type
DeepPartial<T>          // Recursive partial
DeepRequired<T>         // Recursive required
PartialBy<T, K>         // Partial specific keys
RequiredBy<T, K>        // Required specific keys
```

### Props Definition
```typescript
// Always extend base HTML element props when applicable
export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  sekai?: ColorsSekaiKey
  themeMode?: PaletteMode
}

// Use destructuring with ...rest
const Button = ({ sekai, themeMode, ...rest }: ButtonProps) => {
  return <button {...rest} />
}
```

---

## Naming Conventions Summary

### Files
- Components: `PascalCase.tsx` (e.g., `BasicButton.tsx`)
- Hooks: `camelCase.ts` (e.g., `useLocalStorage.ts`)
- Utils: `camelCase.ts` (e.g., `converter.ts`)
- Directories: `kebab-case` (e.g., `text-field/`)

### Components
- Function names: `PascalCase` (e.g., `const BasicButton = () => {}`)
- Props interfaces: `{ComponentName}Props` (e.g., `BasicButtonProps`)
- Sub-components: `{Parent}{Child}` (e.g., `DialogTitleHeader`)

### CSS Classes
- Component classes: `kebab-case` (e.g., `.basic-button`)
- Global utilities: `sekai-*` prefix (e.g., `.sekai-flex-center`)
- Theme variants: `.sekai-color-light`, `.sekai-color-dark`

### Variables
- Constants: `UPPER_SNAKE_CASE` (e.g., `COLORS_SEKAI_KEYS`)
- Functions: `camelCase` (e.g., `convertHexToRgb`)
- React components: `PascalCase`

---

## Best Practices

1. **Prefer editing over creating** - Modify existing patterns instead of creating new ones
2. **Keep complexity low** - Cyclomatic complexity ≤ 8 (ESLint enforced)
3. **Functions under 150 lines** - Break into smaller functions if needed
4. **Single responsibility** - One component, one purpose
5. **Composition over inheritance** - Use composition patterns
6. **Explicit over implicit** - Clear prop types, no magic values
7. **Consistent naming** - Follow established conventions (see CLAUDE.md)
8. **Document complex logic** - Add comments explaining "why", not "what"
9. **Type safety** - Leverage TypeScript fully, avoid `any`
10. **Performance aware** - Memoize expensive operations when needed

---

# コード規約 & ルール（日本語版）

## 重要なルール

### 絶対にやってはいけないこと
1. **dist/を手動で変更しない** - 常にビルドで自動生成
2. **src/**/index.tsを手動で編集しない** - Pythonスクリプトで自動生成
3. **'use client'ディレクティブを手動で追加しない** - Rollupプラグインが注入
4. **`npm run generate-index`をスキップしない** - ファイル追加/削除後は必須
5. **lint警告があるままコミットしない** - CIが失敗する
6. **PR前のビルドをスキップしない** - dist/は最新である必要がある
7. **`any`型を使用しない** - TypeScript strictモードが有効
8. **ESLintエラーを無視しない** - max-warnings=0が適用

### 必ずやるべきこと
1. **最初に`npm install`を実行** - 他のコマンドより前に
2. **`npm run generate-index`を実行** - ファイル変更後
3. **`npm run lint`を実行** - コミット前
4. **`npm run build`を実行** - プッシュ前
5. **Plopを使用** - 新しいコンポーネント作成時（`npm run plop`）
6. **インポート順序を守る** - ESLintが強制: React → 外部 → @/ → 相対 → スタイル
7. **CSSモジュールを使用** - Component.module.scssパターン
8. **`useOptionalSekai`を使用** - テーマ対応コンポーネントで
9. **ベースHTML propsを拡張** - ラッパーコンポーネント作成時
10. **`...rest`プロパティを転送** - 基礎要素へ

---

## インポート順序（ESLint強制）
```typescript
// 1. Reactインポート
import type React from 'react'
import { useState } from 'react'

// 2. 外部ライブラリ
import clsx from 'clsx'

// 3. @/パスエイリアスインポート
import type { ColorsSekaiKey } from '@/styles/sekai-colors'
import { useOptionalSekai } from '@/internal/useOptionalSekai'
import globalStyles from '@/styles/global.module.scss'

// 4. 相対インポート
import { helper } from './helper'

// 5. スタイル（常に最後）
import styles from './Component.module.scss'
```

---

## ESLint適用ルール
- サイクロマティック複雑度 ≤ 8
- 関数あたり最大150行
- console.log、debugger、alert禁止
- letよりconstを優先
- フックの依存配列を網羅的に
- 未使用のインポート/変数禁止
- 型は型専用インポートを使用（`import type`）
- jsx-a11yアクセシビリティチェック

---

## TypeScript規約

### 型ユーティリティ（`@/utils/type`より）
```typescript
ValueOf<T>              // オブジェクト値のユニオン
ArrayElement<T>         // 配列要素の型
DeepPartial<T>          // 再帰的Partial
DeepRequired<T>         // 再帰的Required
PartialBy<T, K>         // 特定キーのみPartial
RequiredBy<T, K>        // 特定キーのみRequired
```

### Props定義
```typescript
// 該当する場合は常にベースHTML要素のpropsを拡張
export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  sekai?: ColorsSekaiKey
  themeMode?: PaletteMode
}

// ...restで分割代入
const Button = ({ sekai, themeMode, ...rest }: ButtonProps) => {
  return <button {...rest} />
}
```

---

## 命名規則まとめ

### ファイル
- コンポーネント: `PascalCase.tsx`（例: `BasicButton.tsx`）
- フック: `camelCase.ts`（例: `useLocalStorage.ts`）
- ユーティリティ: `camelCase.ts`（例: `converter.ts`）
- ディレクトリ: `kebab-case`（例: `text-field/`）

### コンポーネント
- 関数名: `PascalCase`（例: `const BasicButton = () => {}`）
- Propsインターフェース: `{ComponentName}Props`（例: `BasicButtonProps`）
- サブコンポーネント: `{Parent}{Child}`（例: `DialogTitleHeader`）

### CSSクラス
- コンポーネントクラス: `kebab-case`（例: `.basic-button`）
- グローバルユーティリティ: `sekai-*`プレフィックス（例: `.sekai-flex-center`）
- テーマバリアント: `.sekai-color-light`、`.sekai-color-dark`

### 変数
- 定数: `UPPER_SNAKE_CASE`（例: `COLORS_SEKAI_KEYS`）
- 関数: `camelCase`（例: `convertHexToRgb`）
- Reactコンポーネント: `PascalCase`

---

## ベストプラクティス

1. **作成より編集を優先** - 新しいパターンを作成するより既存パターンを修正
2. **複雑度を低く保つ** - サイクロマティック複雑度 ≤ 8（ESLint強制）
3. **関数は150行以下** - 必要に応じて小さな関数に分割
4. **単一責任** - 1コンポーネント、1目的
5. **継承より合成** - コンポジションパターンを使用
6. **暗黙より明示** - 明確なprop型、マジック値を使わない
7. **一貫した命名** - 確立された規約に従う（CLAUDE.md参照）
8. **複雑なロジックを文書化** - 「何を」ではなく「なぜ」を説明するコメントを追加
9. **型安全性** - TypeScriptを最大限に活用、`any`を避ける
10. **パフォーマンスを意識** - 必要に応じて高コストな操作をメモ化
